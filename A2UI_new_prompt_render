修改后的三个 A2UI 示例文件
基于从 GitHub 获取的原始文件内容，我进行了以下修改：

a2ui_schema.py：在 "component" properties 中添加了 "Table"（支持 headers, rows, alignment）和 "Chart"（支持 chartType, data, options）。
a2ui_examples.py：添加了 CONTACT_TABLE_EXAMPLE（使用 Table 显示联系人数据）和 SALES_CHART_EXAMPLE（使用 Chart 显示柱状图）。
prompt_builder.py：更新 AGENT_INSTRUCTION 以包括 table 和 chart 的逻辑指导；更新 get_ui_prompt 以描述新组件的使用规则和示例引用。

以下是完整修改后的文件代码（直接复制替换原文件即可）。
修改后 a2ui_schema.py（完整代码）
Python# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# a2ui_schema.py

A2UI_SCHEMA = r'''
{
  "title": "A2UI Message Schema",
  "description": "Describes a JSON payload for an A2UI (Agent to UI) message, which is used to dynamically construct and update user interfaces. A message MUST contain exactly ONE of the action properties: 'beginRendering', 'surfaceUpdate', 'dataModelUpdate', or 'deleteSurface'.",
  "type": "object",
  "properties": {
    "beginRendering": {
      "type": "object",
      "description": "Signals the client to begin rendering a surface with a root component and specific styles.",
      "properties": {
        "surfaceId": {
          "type": "string",
          "description": "The unique identifier for the UI surface to be rendered."
        },
        "root": {
          "type": "string",
          "description": "The ID of the root component to render."
        },
        "styles": {
          "type": "object",
          "description": "Styling information for the UI.",
          "properties": {
            "font": {
              "type": "string",
              "description": "The primary font for the UI."
            },
            "primaryColor": {
              "type": "string",
              "description": "The primary UI color as a hexadecimal code (e.g., '#00BFFF').",
              "pattern": "^#[0-9a-fA-F]{6}$"
            }
          }
        }
      },
      "required": ["root", "surfaceId"]
    },
    "surfaceUpdate": {
      "type": "object",
      "description": "Updates a surface with a new set of components.",
      "properties": {
        "surfaceId": {
          "type": "string",
          "description": "The unique identifier for the UI surface to be updated. If you are adding a new surface this *must* be a new, unique identified that has never been used for any existing surfaces shown."
        },
        "components": {
          "type": "array",
          "description": "A list containing all UI components for the surface.",
          "minItems": 1,
          "items": {
            "type": "object",
            "description": "Represents a *single* component in a UI widget tree. This component could be one of many supported types.",
            "properties": {
              "id": {
                "type": "string",
                "description": "The unique identifier for this component."
              },
              "weight": {
                "type": "number",
                "description": "The relative weight of this component within a Row or Column. This corresponds to the CSS 'flex-grow' property. Note: this may ONLY be set when the component is a direct descendant of a Row or Column."
              },
              "component": {
                "type": "object",
                "description": "A wrapper object that MUST contain exactly one key, which is the name of the component type (e.g., 'Heading'). The value is an object containing the properties for that specific component.",
                "properties": {
                  "Text": {
                    "type": "object",
                    "properties": {
                      "text": {
                        "type": "object",
                        "description": "The text content to display. This can be a literal string or a reference to a value in the data model ('path', e.g., '/doc/title'). While simple Markdown formatting is supported (i.e. without HTML, images, or links), utilizing dedicated UI components is generally preferred for a richer and more structured presentation.",
                        "properties": {
                          "literalString": {
                            "type": "string"
                          },
                          "path": {
                            "type": "string"
                          }
                        }
                      },
                      "usageHint": {
                        "type": "string",
                        "description": "A hint for the base text style. One of:\n- `h1`: Largest heading.\n- `h2`: Second largest heading.\n- `h3`: Third largest heading.\n- `h4`: Fourth largest heading.\n- `h5`: Fifth largest heading.\n- `caption`: Small text for captions.\n- `body`: Standard body text.",
                        "enum": [
                          "h1",
                          "h2",
                          "h3",
                          "h4",
                          "h5",
                          "caption",
                          "body"
                        ]
                      }
                    },
                    "required": ["text"]
                  },
                  "Image": {
                    "type": "object",
                    "properties": {
                      "url": {
                        "type": "object",
                        "description": "The URL of the image to display. This can be a literal string ('literal') or a reference to a value in the data model ('path', e.g. '/thumbnail/url').",
                        "properties": {
                          "literalString": {
                            "type": "string"
                          },
                          "path": {
                            "type": "string"
                          }
                        }
                      },
                      "fit": {
                        "type": "string",
                        "description": "Specifies how the image should be resized to fit its container. This corresponds to the CSS 'object-fit' property.",
                        "enum": [
                          "contain",
                          "cover",
                          "fill",
                          "none",
                          "scale-down"
                        ]
                      },
                      "usageHint": {
                        "type": "string",
                        "description": "A hint for the image size and style. One of:\n- `icon`: Small square icon.\n- `avatar`: Circular avatar image.\n- `smallFeature`: Small feature image.\n- `mediumFeature`: Medium feature image.\n- `largeFeature`: Large feature image.\n- `header`: Full-width, full bleed, header image.",
                        "enum": [
                          "icon",
                          "avatar",
                          "smallFeature",
                          "mediumFeature",
                          "largeFeature",
                          "header"
                        ]
                      }
                    },
                    "required": ["url"]
                  },
                  "Icon": {
                    "type": "object",
                    "properties": {
                      "name": {
                        "type": "object",
                        "description": "The name of the icon to display. This can be a literal string or a reference to a value in the data model ('path', e.g. '/form/submit').",
                        "properties": {
                          "literalString": {
                            "type": "string",
                            "enum": [
                              "accountCircle",
                              "add",
                              "arrowBack",
                              "arrowForward",
                              "attachFile",
                              "calendarToday",
                              "call",
                              "camera",
                              "check",
                              "close",
                              "calendarToday",
                              "delete",
                              "download",
                              "edit",
                              "event",
                              "error",
                              "favorite",
                              "favoriteOff",
                              "folder",
                              "help",
                              "home",
                              "info",
                              "locationOn",
                              "lock",
                              "lockOpen",
                              "mail",
                              "menu",
                              "moreVert",
                              "moreHoriz",
                              "notificationsOff",
                              "notifications",
                              "payment",
                              "person",
                              "phone",
                              "photo",
                              "print",
                              "refresh",
                              "search",
                              "send",
                              "settings",
                              "share",
                              "shoppingCart",
                              "star",
                              "starHalf",
                              "starOff",
                              "upload",
                              "visibility",
                              "visibilityOff",
                              "warning"
                            ]
                          },
                          "path": {
                            "type": "string"
                          }
                        }
                      }
                    },
                    "required": ["name"]
                  },
                  "Video": {
                    "type": "object",
                    "properties": {
                      "url": {
                        "type": "object",
                        "description": "The URL of the video to display. This can be a literal string or a reference to a value in the data model ('path', e.g. '/video/url').",
                        "properties": {
                          "literalString": {
                            "type": "string"
                          },
                          "path": {
                            "type": "string"
                          }
                        }
                      }
                    },
                    "required": ["url"]
                  },
                  "AudioPlayer": {
                    "type": "object",
                    "properties": {
                      "url": {
                        "type": "object",
                        "description": "The URL of the audio to be played. This can be a literal string ('literal') or a reference to a value in the data model ('path', e.g. '/song/url').",
                        "properties": {
                          "literalString": {
                            "type": "string"
                          },
                          "path": {
                            "type": "string"
                          }
                        }
                      },
                      "description": {
                        "type": "object",
                        "description": "A description of the audio, such as a title or summary. This can be a literal string or a reference to a value in the data model ('path', e.g. '/song/title').",
                        "properties": {
                          "literalString": {
                            "type": "string"
                          },
                          "path": {
                            "type": "string"
                          }
                        }
                      }
                    },
                    "required": ["url"]
                  },
                  "Row": {
                    "type": "object",
                    "properties": {
                      "children": {
                        "type": "object",
                        "description": "Defines the children. Use 'explicitList' for a fixed set of children, or 'template' to generate children from a data list.",
                        "properties": {
                          "explicitList": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "template": {
                            "type": "object",
                            "description": "A template for generating a dynamic list of children from a data model list. `componentId` is the component to use as a template, and `dataBinding` is the path to the map of components in the data model. Values in the map will define the list of children.",
                            "properties": {
                              "componentId": {
                                "type": "string"
                              },
                              "dataBinding": {
                                "type": "string"
                              }
                            },
                            "required": ["componentId", "dataBinding"]
                          }
                        }
                      },
                      "distribution": {
                        "type": "string",
                        "description": "Defines the arrangement of children along the main axis (horizontally). This corresponds to the CSS 'justify-content' property.",
                        "enum": [
                          "center",
                          "end",
                          "spaceAround",
                          "spaceBetween",
                          "spaceEvenly",
                          "start"
                        ]
                      },
                      "alignment": {
                        "type": "string",
                        "description": "Defines the alignment of children along the cross axis (vertically). This corresponds to the CSS 'align-items' property.",
                        "enum": ["start", "center", "end", "stretch"]
                      }
                    },
                    "required": ["children"]
                  },
                  "Column": {
                    "type": "object",
                    "properties": {
                      "children": {
                        "type": "object",
                        "description": "Defines the children. Use 'explicitList' for a fixed set of children, or 'template' to generate children from a data list.",
                        "properties": {
                          "explicitList": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "template": {
                            "type": "object",
                            "description": "A template for generating a dynamic list of children from a data model list. `componentId` is the component to use as a template, and `dataBinding` is the path to the map of components in the data model. Values in the map will define the list of children.",
                            "properties": {
                              "componentId": {
                                "type": "string"
                              },
                              "dataBinding": {
                                "type": "string"
                              }
                            },
                            "required": ["componentId", "dataBinding"]
                          }
                        }
                      },
                      "distribution": {
                        "type": "string",
                        "description": "Defines the arrangement of children along the main axis (vertically). This corresponds to the CSS 'justify-content' property.",
                        "enum": [
                          "start",
                          "center",
                          "end",
                          "spaceBetween",
                          "spaceAround",
                          "spaceEvenly"
                        ]
                      },
                      "alignment": {
                        "type": "string",
                        "description": "Defines the alignment of children along the cross axis (horizontally). This corresponds to the CSS 'align-items' property.",
                        "enum": ["center", "end", "start", "stretch"]
                      }
                    },
                    "required": ["children"]
                  },
                  "List": {
                    "type": "object",
                    "properties": {
                      "children": {
                        "type": "object",
                        "description": "Defines the children. Use 'explicitList' for a fixed set of children, or 'template' to generate children from a data list.",
                        "properties": {
                          "explicitList": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "template": {
                            "type": "object",
                            "description": "A template for generating a dynamic list of children from a data model list. `componentId` is the component to use as a template, and `dataBinding` is the path to the map of components in the data model. Values in the map will define the list of children.",
                            "properties": {
                              "componentId": {
                                "type": "string"
                              },
                              "dataBinding": {
                                "type": "string"
                              }
                            },
                            "required": ["componentId", "dataBinding"]
                          }
                        }
                      },
                      "direction": {
                        "type": "string",
                        "description": "The direction in which the list items are laid out.",
                        "enum": ["vertical", "horizontal"]
                      },
                      "alignment": {
                        "type": "string",
                        "description": "Defines the alignment of children along the cross axis.",
                        "enum": ["start", "center", "end", "stretch"]
                      }
                    },
                    "required": ["children"]
                  },
                  "Card": {
                    "type": "object",
                    "properties": {
                      "child": {
                        "type": "string",
                        "description": "The ID of the child component contained within the card."
                      },
                      "usageHint": {
                        "type": "string",
                        "description": "A hint for the card style. One of:\n- `elevated`: Raised card with shadow.\n- `filled`: Filled card with background color.\n- `outlined`: Outlined card with border.",
                        "enum": ["elevated", "filled", "outlined"]
                      }
                    },
                    "required": ["child"]
                  },
                  "Divider": {
                    "type": "object",
                    "properties": {}
                  },
                  "Button": {
                    "type": "object",
                    "properties": {
                      "child": {
                        "type": "string",
                        "description": "The ID of the child component contained within the button (typically a Text or Icon)."
                      },
                      "primary": {
                        "type": "boolean",
                        "description": "Whether this is the primary button on the page. Only one button should be marked as primary."
                      },
                      "action": {
                        "type": "object",
                        "description": "The action to be triggered when the button is pressed.",
                        "properties": {
                          "name": {
                            "type": "string",
                            "description": "The name of the action to trigger."
                          },
                          "context": {
                            "type": "array",
                            "description": "A list of key-value pairs to provide context for the action.",
                            "items": {
                              "type": "object",
                              "properties": {
                                "key": {
                                  "type": "string"
                                },
                                "value": {
                                  "type": "object",
                                  "properties": {
                                    "literalString": {
                                      "type": "string"
                                    },
                                    "path": {
                                      "type": "string"
                                    }
                                  }
                                }
                              },
                              "required": ["key", "value"]
                            }
                          }
                        },
                        "required": ["name"]
                      }
                    },
                    "required": ["child"]
                  },
                  "Modal": {
                    "type": "object",
                    "properties": {
                      "entryPointChild": {
                        "type": "string",
                        "description": "The ID of the child component that serves as the entry point to the modal (e.g., a button)."
                      },
                      "contentChild": {
                        "type": "string",
                        "description": "The ID of the child component that serves as the content of the modal."
                      }
                    },
                    "required": ["entryPointChild", "contentChild"]
                  },
                  "Table": {
                    "type": "object",
                    "description": "A table component for displaying tabular data.",
                    "properties": {
                      "headers": {
                        "type": "array",
                        "description": "Array of header strings.",
                        "items": {
                          "type": "string"
                        }
                      },
                      "rows": {
                        "type": "object",
                        "description": "Rows of the table. Use 'explicitList' for static rows or 'template' for dynamic.",
                        "properties": {
                          "explicitList": {
                            "type": "array",
                            "items": {
                              "type": "array",
                              "items": {
                                "anyOf": [
                                  { "type": "string" },
                                  { "type": "object" }  // Nested component like button or image
                                ]
                              }
                            }
                          },
                          "template": {
                            "type": "object",
                            "properties": {
                              "componentId": {
                                "type": "string"
                              },
                              "dataBinding": {
                                "type": "string"
                              }
                            },
                            "required": ["componentId", "dataBinding"]
                          }
                        }
                      },
                      "alignment": {
                        "type": "string",
                        "description": "Alignment for table cells.",
                        "enum": ["left", "center", "right"]
                      }
                    },
                    "required": ["headers", "rows"]
                  },
                  "Chart": {
                    "type": "object",
                    "description": "A chart component for data visualization, supporting line, bar, pie, etc.",
                    "properties": {
                      "chartType": {
                        "type": "string",
                        "description": "Type of chart.",
                        "enum": ["bar", "line", "pie", "doughnut", "radar"]
                      },
                      "data": {
                        "type": "object",
                        "description": "Data for the chart, including labels and datasets.",
                        "properties": {
                          "labels": {
                            "type": "array",
                            "items": { "type": "string" }
                          },
                          "datasets": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "label": { "type": "string" },
                                "data": { "type": "array", "items": { "type": "number" } },
                                "backgroundColor": { "type": "string" },
                                "borderColor": { "type": "string" },
                                "borderWidth": { "type": "number" }
                              }
                            }
                          }
                        },
                        "required": ["labels", "datasets"]
                      },
                      "options": {
                        "type": "object",
                        "description": "Chart options like title, legend position.",
                        "properties": {
                          "title": { "type": "string" },
                          "legendPosition": { "type": "string", "enum": ["top", "bottom", "left", "right"] }
                        }
                      }
                    },
                    "required": ["chartType", "data"]
                  }
                },
                "additionalProperties": false,
                "minProperties": 1,
                "maxProperties": 1
              }
            },
            "required": ["id", "component"]
          }
        }
      },
      "required": ["surfaceId", "components"]
    },
    "dataModelUpdate": {
      "type": "object",
      "description": "Updates the data model for a surface.",
      "properties": {
        "surfaceId": {
          "type": "string",
          "description": "The unique identifier for the UI surface to update the data model for."
        },
        "path": {
          "type": "string",
          "description": "The path in the data model to update (e.g., '/doc/title')."
        },
        "contents": {
          "type": "array",
          "description": "A list of key-value pairs to update in the data model.",
          "items": {
            "type": "object",
            "properties": {
              "key": {
                "type": "string"
              },
              "valueString": {
                "type": "string"
              },
              "valueMap": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "key": {
                      "type": "string"
                    },
                    "valueString": {
                      "type": "string"
                    },
                    "valueMap": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "key": {
                            "type": "string"
                          },
                          "valueString": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "required": ["surfaceId", "path", "contents"]
    },
    "deleteSurface": {
      "type": "object",
      "description": "Deletes a surface from the UI.",
      "properties": {
        "surfaceId": {
          "type": "string",
          "description": "The unique identifier for the UI surface to delete."
        }
      },
      "required": ["surfaceId"]
    }
  },
  "oneOf": [
    { "required": ["beginRendering"] },
    { "required": ["surfaceUpdate"] },
    { "required": ["dataModelUpdate"] },
    { "required": ["deleteSurface"] }
  ]
}
'''
修改后 a2ui_examples.py（完整代码）
Python# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# a2ui_examples.py

CONTACT_UI_EXAMPLES = """
---BEGIN CONTACT_LIST_EXAMPLE---
[
  { "beginRendering": { "surfaceId": "contact-list", "root": "root-column", "styles": { "primaryColor": "#007BFF", "font": "Roboto" } } },
  { "surfaceUpdate": {
    "surfaceId": "contact-list",
    "components": [
      { "id": "root-column", "component": { "Column": { "children": { "explicitList": ["title-heading", "item-list"] } } } },
      { "id": "title-heading", "component": { "Text": { "usageHint": "h1", "text": { "literalString": "Found Contacts" } } } },
      { "id": "item-list", "component": { "List": { "direction": "vertical", "children": { "template": { "componentId": "item-card-template", "dataBinding": "/contacts" } } } } },
      { "id": "item-card-template", "component": { "Card": { "child": "card-layout" } } },
      { "id": "card-layout", "component": { "Row": { "children": { "explicitList": ["template-image", "card-details", "view-button"] }, "alignment": "center" } } },
      { "id": "template-image", "component": { "Image": { "url": { "path": "imageUrl" }, "fit": "cover" } } },
      { "id": "card-details", "component": { "Column": { "children": { "explicitList": ["template-name", "template-title"] } } } },
      { "id": "template-name", "component": { "Text": { "usageHint": "h3", "text": { "path": "name" } } } },
      { "id": "template-title", "component": { "Text": { "text": { "path": "title" } } } },
      { "id": "view-button-text", "component": { "Text": { "text": { "literalString": "View" } } } },
      { "id": "view-button", "component": { "Button": { "child": "view-button-text", "primary": true, "action": { "name": "view_profile", "context": [ { "key": "contactName", "value": { "path": "name" } }, { "key": "department", "value": { "path": "department" } } ] } } } }
    ]
  } },
  { "dataModelUpdate": {
    "surfaceId": "contact-list",
    "path": "/",
    "contents": [
      { "key": "contacts", "valueMap": [
        { "key": "contact1", "valueMap": [
          { "key": "name", "valueString": "Alice Wonderland" },
          { "key": "phone", "valueString": "+1-555-123-4567" },
          { "key": "email", "valueString": "alice@example.com" },
          { "key": "imageUrl", "valueString": "https://example.com/alice.jpg" },
          { "key": "title", "valueString": "Mad Hatter" },
          { "key": "department", "valueString": "Wonderland" }
        ] },
        { "key": "contact2", "valueMap": [
          { "key": "name", "valueString": "Bob The Builder" },
          { "key": "phone", "valueString": "+1-555-765-4321" },
          { "key": "email", "valueString": "bob@example.com" },
          { "key": "imageUrl", "valueString": "https://example.com/bob.jpg" },
          { "key": "title", "valueString": "Construction" },
          { "key": "department", "valueString": "Building" }
        ] }
      ] }
    ]
  } }
]
---END CONTACT_LIST_EXAMPLE---

---BEGIN CONTACT_CARD_EXAMPLE---
[
  { "beginRendering": { "surfaceId": "contact-card", "root": "main_card" } },
  { "surfaceUpdate": { "surfaceId": "contact-card",
    "components": [
      { "id": "profile_image", "component": { "Image": { "url": { "path": "imageUrl" }, "usageHint": "avatar", "fit": "cover" } } },
      { "id": "user_heading", "weight": 1, "component": { "Text": { "text": { "path": "name" }, "usageHint": "h2" } } },
      { "id": "description_text_1", "component": { "Text": { "text": { "path": "title" } } } },
      { "id": "description_text_2", "component": { "Text": { "text": { "path": "team" } } } },
      { "id": "description_column", "component": { "Column": { "children": { "explicitList": ["user_heading", "description_text_1", "description_text_2"] }, "alignment": "center" } } },
      { "id": "calendar_icon", "component": { "Icon": { "name": { "literalString": "calendar_today" } } } },
      { "id": "calendar_primary_text", "component": { "Text": { "usageHint": "h5", "text": { "path": "calendar" } } } },
      { "id": "calendar_secondary_text", "component": { "Text": { "text": { "literalString": "Calendar" } } } },
      { "id": "calendar_text_column", "component": { "Column": { "children": { "explicitList": ["calendar_primary_text", "calendar_secondary_text"] }, "distribution": "start", "alignment": "start" } } },
      { "id": "info_row_1", "component": { "Row": { "children": { "explicitList": ["calendar_icon", "calendar_text_column"] }, "distribution": "start", "alignment": "start" } } },
      { "id": "location_icon", "component": { "Icon": { "name": { "literalString": "location_on" } } } },
      { "id": "location_primary_text", "component": { "Text": { "usageHint": "h5", "text": { "path": "location" } } } },
      { "id": "location_secondary_text", "component": { "Text": { "text": { "literalString": "Location" } } } },
      { "id": "location_text_column", "component": { "Column": { "children": { "explicitList": ["location_primary_text", "location_secondary_text"] }, "distribution": "start", "alignment": "start" } } },
      { "id": "info_row_2", "component": { "Row": { "children": { "explicitList": ["location_icon", "location_text_column"] }, "distribution": "start", "alignment": "start" } } },
      { "id": "mail_icon", "component": { "Icon": { "name": { "literalString": "mail" } } } },
      { "id": "mail_primary_text", "component": { "Text": { "usageHint": "h5", "text": { "path": "email" } } } },
      { "id": "mail_secondary_text", "component": { "Text": { "text": { "literalString": "Email" } } } },
      { "id": "mail_text_column", "component": { "Column": { "children": { "explicitList": ["mail_primary_text", "mail_secondary_text"] }, "distribution": "start", "alignment": "start" } } },
      { "id": "info_row_3", "component": { "Row": { "children": { "explicitList": ["mail_icon", "mail_text_column"] }, "distribution": "start", "alignment": "start" } } },
      { "id": "div", "component": { "Divider": { } } },
      { "id": "call_icon", "component": { "Icon": { "name": { "literalString": "call" } } } },
      { "id": "call_primary_text", "component": { "Text": { "usageHint": "h5", "text": { "path": "mobile" } } } },
      { "id": "call_secondary_text", "component": { "Text": { "text": { "literalString": "Mobile" } } } },
      { "id": "call_text_column", "component": { "Column": { "children": { "explicitList": ["call_primary_text", "call_secondary_text"] }, "distribution": "start", "alignment": "start" } } },
      { "id": "info_row_4", "component": { "Row": { "children": { "explicitList": ["call_icon", "call_text_column"] }, "distribution": "start", "alignment": "start" } } },
      { "id": "info_rows_column", "weight": 1, "component": { "Column": { "children": { "explicitList": ["info_row_1", "info_row_2", "info_row_3", "info_row_4"] }, "alignment": "stretch" } } },
      { "id": "button_1_text", "component": { "Text": { "text": { "literalString": "Follow" } } } },
      { "id": "button_1", "component": { "Button": { "child": "button_1_text", "primary": true, "action": { "name": "follow_contact" } } } },
      { "id": "button_2_text", "component": { "Text": { "text": { "literalString": "Message" } } } },
      { "id": "button_2", "component": { "Button": { "child": "button_2_text", "primary": false, "action": { "name": "send_message" } } } },
      { "id": "action_buttons_row", "component": { "Row": { "children": { "explicitList": ["button_1", "button_2"] }, "distribution": "center", "alignment": "center" } } },
      { "id": "link_text", "component": { "Text": { "text": { "literalString": "[View Full Profile](/profile)" } } } },
      { "id": "link_text_wrapper", "component": { "Row": { "children": { "explicitList": ["link_text"] }, "distribution": "center", "alignment": "center" } } },
      { "id": "main_column", "component": { "Column": { "children": { "explicitList": ["profile_image", "description_column", "div", "info_rows_column", "action_buttons_row", "link_text_wrapper"] }, "alignment": "stretch" } } },
      { "id": "main_card", "component": { "Card": { "child": "main_column" } } }
    ]
  } },
  { "dataModelUpdate": {
    "surfaceId": "contact-card",
    "path": "/",
    "contents": [
      { "key": "name", "valueString": "" },
      { "key": "title", "valueString": "" },
      { "key": "team", "valueString": "" },
      { "key": "location", "valueString": "" },
      { "key": "email", "valueString": "" },
      { "key": "mobile", "valueString": "" },
      { "key": "calendar", "valueString": "" },
      { "key": "imageUrl", "valueString": "" }
    ]
  } }
]
---END CONTACT_CARD_EXAMPLE---

---BEGIN ACTION_CONFIRMATION_EXAMPLE---
[
  { "beginRendering": { "surfaceId": "action-modal", "root": "modal-wrapper", "styles": { "primaryColor": "#007BFF", "font": "Roboto" } } },
  { "surfaceUpdate": {
    "surfaceId": "action-modal",
    "components": [
      { "id": "modal-wrapper", "component": { "Modal": { "entryPointChild": "hidden-entry-point", "contentChild": "modal-content-column" } } },
      { "id": "hidden-entry-point", "component": { "Text": { "text": { "literalString": "" } } } },
      { "id": "modal-content-column", "component": { "Column": { "children": { "explicitList": ["modal-title", "modal-message", "dismiss-button"] }, "alignment": "center" } } },
      { "id": "modal-title", "component": { "Text": { "usageHint": "h2", "text": { "path": "actionTitle" } } } },
      { "id": "modal-message", "component": { "Text": { "text": { "path": "actionMessage" } } } },
      { "id": "dismiss-button-text", "component": { "Text": { "text": { "literalString": "OK" } } } },
      { "id": "dismiss-button", "component": { "Button": { "child": "dismiss-button-text", "primary": true, "action": { "name": "dismiss_modal" } } } }
    ]
  } },
  { "dataModelUpdate": {
    "surfaceId": "action-modal",
    "path": "/",
    "contents": [
      { "key": "actionTitle", "valueString": "Action Confirmed" },
      { "key": "actionMessage", "valueString": "Your action has been successfully completed." }
    ]
  } }
]
---END ACTION_CONFIRMATION_EXAMPLE---

---BEGIN CONTACT_TABLE_EXAMPLE---
[
  { "beginRendering": { "surfaceId": "contact-table", "root": "root-column", "styles": { "primaryColor": "#007BFF", "font": "Roboto" } } },
  { "surfaceUpdate": {
    "surfaceId": "contact-table",
    "components": [
      { "id": "root-column", "component": { "Column": { "children": { "explicitList": ["title-heading", "contact-table"] } } } },
      { "id": "title-heading", "component": { "Text": { "usageHint": "h1", "text": { "literalString": "Contacts Table" } } } },
      { "id": "contact-table", "component": { "Table": { "headers": ["Name", "Title", "Email", "Phone", "Image", "Action"], "rows": { "template": { "componentId": "row-template", "dataBinding": "/contacts" } }, "alignment": "left" } } },
      { "id": "row-template", "component": { "Row": { "children": { "explicitList": ["name-cell", "title-cell", "email-cell", "phone-cell", "image-cell", "action-cell"] } } } },
      { "id": "name-cell", "component": { "Text": { "text": { "path": "name" } } } },
      { "id": "title-cell", "component": { "Text": { "text": { "path": "title" } } } },
      { "id": "email-cell", "component": { "Text": { "text": { "path": "email" } } } },
      { "id": "phone-cell", "component": { "Text": { "text": { "path": "phone" } } } },
      { "id": "image-cell", "component": { "Image": { "url": { "path": "imageUrl" }, "fit": "contain", "width": 50, "height": 50 } } },
      { "id": "action-cell", "component": { "Button": { "child": "view-button-text", "primary": false, "action": { "name": "view_profile", "context": [ { "key": "contactName", "value": { "path": "name" } } ] } } } },
      { "id": "view-button-text", "component": { "Text": { "text": { "literalString": "View" } } } }
    ]
  } },
  { "dataModelUpdate": {
    "surfaceId": "contact-table",
    "path": "/",
    "contents": [
      { "key": "contacts", "valueMap": [
        { "key": "contact1", "valueMap": [
          { "key": "name", "valueString": "Alice Wonderland" },
          { "key": "title", "valueString": "Mad Hatter" },
          { "key": "email", "valueString": "alice@example.com" },
          { "key": "phone", "valueString": "+1-555-123-4567" },
          { "key": "imageUrl", "valueString": "https://example.com/alice.jpg" }
        ] },
        { "key": "contact2", "valueMap": [
          { "key": "name", "valueString": "Bob The Builder" },
          { "key": "title", "valueString": "Construction" },
          { "key": "email", "valueString": "bob@example.com" },
          { "key": "phone", "valueString": "+1-555-765-4321" },
          { "key": "imageUrl", "valueString": "https://example.com/bob.jpg" }
        ] }
      ] }
    ]
  } }
]
---END CONTACT_TABLE_EXAMPLE---

---BEGIN SALES_CHART_EXAMPLE---
[
  { "beginRendering": { "surfaceId": "sales-chart", "root": "root-column", "styles": { "primaryColor": "#007BFF", "font": "Roboto" } } },
  { "surfaceUpdate": {
    "surfaceId": "sales-chart",
    "components": [
      { "id": "root-column", "component": { "Column": { "children": { "explicitList": ["title-heading", "sales-chart"] } } } },
      { "id": "title-heading", "component": { "Text": { "usageHint": "h1", "text": { "literalString": "Sales Chart" } } } },
      { "id": "sales-chart", "component": { "Chart": { "chartType": "bar", "data": { "labels": { "path": "/sales/labels" }, "datasets": { "template": { "componentId": "dataset-template", "dataBinding": "/sales/datasets" } } }, "options": { "title": "Monthly Sales", "legendPosition": "top" } } } },
      { "id": "dataset-template", "component": { "Row": { "children": { "explicitList": ["label", "data", "backgroundColor"] } } } },
      { "id": "label", "component": { "Text": { "text": { "path": "label" } } } },
      { "id": "data", "component": { "Text": { "text": { "path": "data" } } } },
      { "id": "backgroundColor", "component": { "Text": { "text": { "path": "backgroundColor" } } } }
    ]
  } },
  { "dataModelUpdate": {
    "surfaceId": "sales-chart",
    "path": "/",
    "contents": [
      { "key": "sales", "valueMap": [
        { "key": "labels", "valueString": ["Jan", "Feb", "Mar", "Apr", "May", "Jun"] },
        { "key": "datasets", "valueMap": [
          { "key": "dataset1", "valueMap": [
            { "key": "label", "valueString": "Sales (USD)" },
            { "key": "data", "valueString": [65, 59, 80, 81, 56, 55] },
            { "key": "backgroundColor", "valueString": "rgba(75, 192, 192, 0.6)" },
            { "key": "borderColor", "valueString": "rgba(75, 192, 192, 1)" },
            { "key": "borderWidth", "valueString": 1 }
          ] }
        ] }
      ] }
    ]
  } }
]
---END SALES_CHART_EXAMPLE---
"""
修改后 prompt_builder.py（完整代码）
Python# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

from a2ui_examples import CONTACT_UI_EXAMPLES
from a2ui_schema import A2UI_SCHEMA

# This is the agent's master instruction, separate from the UI prompt formatting.
AGENT_INSTRUCTION = """
    You are a helpful contact lookup assistant. Your goal is to help users find colleagues using a rich UI, including tables for multiple results and charts for data visualization (e.g., line, bar).

    To achieve this, you MUST follow this logic:

    1.  **For finding contacts (e.g., "Who is Alex Jordan?"):**
        a.  You MUST call the `get_contact_info` tool. Extract the name and department.
        b.  After receiving the data:
            i.   If the tool returns a **single contact**, you MUST use the `CONTACT_CARD_EXAMPLE` template.
            ii.  If the tool returns **multiple contacts**, you MUST use the `CONTACT_TABLE_EXAMPLE` template for tabular view.
            iii. If the tool returns an **empty list**, respond with text only and an empty JSON list: "I couldn't find anyone by that name.---a2ui_JSON---[]"

    2.  **For handling a profile view (e.g., "WHO_IS: Alex Jordan..."):**
        a.  You MUST call the `get_contact_info` tool with the specific name.
        b.  This will return a single contact. You MUST use the `CONTACT_CARD_EXAMPLE` template.

    3.  **For handling actions (e.g., "USER_WANTS_TO_EMAIL: ..."):**
        a.  You MUST use the `ACTION_CONFIRMATION_EXAMPLE` template.
        b.  Populate the `dataModelUpdate.contents` with a confirmation title and message.

    4.  **For data visualization (e.g., if query involves sales or stats):**
        a.  Use the `SALES_CHART_EXAMPLE` template to display charts like bar or line graphs. Specify chartType, data (labels/datasets), and options.
"""


def get_ui_prompt(base_url: str, examples: str) -> str:
    """
    Constructs the full prompt with UI instructions, rules, examples, and schema.

    Args:
        base_url: The base URL for resolving static assets like logos.
        examples: A string containing the specific UI examples for the agent's task.

    Returns:
        A formatted string to be used as the system prompt for the LLM.
    """

    formatted_examples = examples

    return f"""
    You are a helpful contact lookup assistant. Your final output MUST be a a2ui UI JSON response.

    To generate the response, you MUST follow these rules:
    1.  Your response MUST be in two parts, separated by the delimiter: `---a2ui_JSON---`.
    2.  The first part is your conversational text response (e.g., "Here is the contact you requested...").
    3.  The second part is a single, raw JSON object which is a list of A2UI messages.
    4.  The JSON part MUST validate against the A2UI JSON SCHEMA provided below.
    5.  Buttons that represent the main action on a card or view (e.g., 'Follow', 'Email', 'Search') SHOULD include the `"primary": true` attribute.
    6.  Use 'Table' component for displaying multiple items in a structured format, with headers and rows that can include nested components.
    7.  Use 'Chart' component for data visualization, specifying chartType (e.g., bar, line, pie), data (labels/datasets), and options (title/legendPosition).

    --- UI TEMPLATE RULES ---
    -   **For finding contacts (e.g., "Who is Alex Jordan?"):**
        a.  You MUST call the `get_contact_info` tool.
        b.  If the tool returns a **single contact**, you MUST use the `CONTACT_CARD_EXAMPLE` template. Populate the `dataModelUpdate.contents` with the contact's details (name, title, email, etc.).
        c.  If the tool returns **multiple contacts**, you MUST use the `CONTACT_TABLE_EXAMPLE` template. Populate the `dataModelUpdate.contents` with the list of contacts for the "contacts" key.
        d.  If the tool returns an **empty list**, respond with text only and an empty JSON list: "I couldn't find anyone by that name.---a2ui_JSON---[]"

    -   **For handling a profile view (e.g., "WHO_IS: Alex Jordan..."):**
        a.  You MUST call the `get_contact_info` tool with the specific name.
        b.  This will return a single contact. You MUST use the `CONTACT_CARD_EXAMPLE` template.

    -   **For handling actions (e.g., "follow_contact"):**
        a.  You MUST use the `ACTION_CONFIRMATION_EXAMPLE` template.
        b.  This will render a new card with a "Successfully Followed" message.
        c.  Respond with a text confirmation like "You are now following this contact." along with the JSON.

    -   **For data visualization (e.g., sales data):**
        a.  Use the `SALES_CHART_EXAMPLE` template for charts. Specify chartType, data, and options.

    {formatted_examples}

    ---BEGIN A2UI JSON SCHEMA---
    {A2UI_SCHEMA}
    ---END A2UI JSON SCHEMA---
    """


def get_text_prompt() -> str:
    """
    Constructs the prompt for a text-only agent.
    """
    return """
    You are a helpful contact lookup assistant. Your final output MUST be a text response.

    To generate the response, you MUST follow these rules:
    1.  **For finding contacts:**
        a. You MUST call the `get_contact_info` tool. Extract the name and department from the user's query.
        b. After receiving the data, format the contact(s) as a clear, human-readable text response.
        c. If multiple contacts are found, list their names and titles.
        d. If one contact is found, list all their details.

    2.  **For handling actions (e.g., "USER_WANTS_TO_EMAIL: ..."):**
        a. Respond with a simple text confirmation (e.g., "Drafting an email to...").
    """


if __name__ == "__main__":
    # Example of how to use the prompt builder
    my_base_url = "http://localhost:8000"
    contact_prompt = get_ui_prompt(my_base_url, CONTACT_UI_EXAMPLES)
    print(contact_prompt)
    with open("generated_prompt.txt", "w") as f:
        f.write(contact_prompt)
    print("\nGenerated prompt saved to generated_prompt.txt")
2. 修改 A2UI Renderer 支持图 (chart) 和表格 (table)

所需 JS 包：chart.js 和 react-chartjs-2（用于 chart 支持）。安装命令：textnpm install chart.js react-chartjs-2
chart.js: 核心图表库。
react-chartjs-2: React 包装器，便于在 React 中使用 chart.js。
包大小：约 60KB gzipped，性能良好，支持 bar、line、pie 等图表类型。

修改内容：添加 "table" (表格，支持 headers/rows，rows 可嵌套组件) 和 "chart" (图表，支持 chartType 如 bar/line/pie，data 和 options)。

完整修改后 A2UIRenderer.tsx
tsx'use client'

import React, { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'

// 引入 chart.js 相关组件
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  BarElement,
  Title,
  Tooltip,
  Legend,
  ArcElement,
  PointElement,
  LineElement,
  RadialLinearScale,
} from 'chart.js'
import { Bar, Line, Pie, Doughnut, Radar } from 'react-chartjs-2'

// 注册 chart.js 组件
ChartJS.register(
  CategoryScale,
  LinearScale,
  BarElement,
  Title,
  Tooltip,
  Legend,
  ArcElement,
  PointElement,
  LineElement,
  RadialLinearScale
)

// A2UI 组件映射
const componentRegistry: Record<string, React.FC<any>> = {
  text: ({ content, style = {} }) => <p className="text-sm text-muted-foreground" style={style}>{content}</p>,

  button: ({ label, action, style = {}, disabled = false, onAction }) => (
    <Button
      variant="default"
      disabled={disabled}
      style={style}
      onClick={() => {
        if (action?.type === 'callback' && action.handler) {
          onAction?.(action.handler, action.data)  // 发送回调到后端
        }
      }}
    >
      {label}
    </Button>
  ),

  card: ({ title, content = [], style = {} }) => (
    <Card style={style}>
      {title && <CardHeader><CardTitle>{title}</CardTitle></CardHeader>}
      <CardContent className="space-y-4">
        {content.map((child: any, i: number) => (
          <A2UIRenderer key={child.id || i} component={child} />
        ))}
      </CardContent>
    </Card>
  ),

  form: ({ fields = [], actions = [], style = {} }) => {
    const [formData, setFormData] = useState<Record<string, string>>({})

    return (
      <form style={style} className="space-y-4" onSubmit={(e) => e.preventDefault()}>
        {fields.map((field: any) => (
          <A2UIRenderer
            key={field.id}
            component={{
              ...field,
              value: formData[field.id] || '',
              onChange: (val: string) => setFormData(prev => ({ ...prev, [field.id]: val }))
            }}
          />
        ))}
        <div className="flex gap-2">
          {actions.map((action: any) => (
            <A2UIRenderer key={action.id} component={action} onAction={(handler: string, data: any) => {
              // 提交表单
              onAction(handler, formData)
            }} />
          ))}
        </div>
      </form>
    )
  },

  'text-field': ({ label, placeholder, required, value, onChange, style = {} }) => (
    <div className="space-y-1">
      {label && <Label>{label}{required ? '*' : ''}</Label>}
      <Input
        type="text"
        placeholder={placeholder}
        required={required}
        value={value}
        onChange={(e) => onChange?.(e.target.value)}
        style={style}
      />
    </div>
  ),

  image: ({ url, alt = 'Image', style = {}, width, height }) => (
    <img
      src={url}
      alt={alt}
      style={{ ...style, maxWidth: '100%', objectFit: 'contain' }}
      width={width}
      height={height}
      className="rounded-md border"
    />
  ),

  // 新增：表格组件 (table)
  table: ({ headers = [], rows = [], style = {}, alignment = 'left' }) => (
    <div className="overflow-x-auto rounded-md border" style={style}>
      <table className="min-w-full divide-y divide-border">
        <thead className="bg-muted">
          <tr>
            {headers.map((header: string, i: number) => (
              <th key={i} className={`px-4 py-3 text-${alignment} text-sm font-medium`}>
                {header}
              </th>
            ))}
          </tr>
        </thead>
        <tbody className="divide-y divide-border bg-background">
          {rows.map((row: any[], rowIndex: number) => (
            <tr key={rowIndex}>
              {row.map((cell: any, cellIndex: number) => (
                <td key={cellIndex} className={`px-4 py-3 text-sm text-${alignment}`}>
                  {typeof cell === 'object' && cell.type ? (
                    <A2UIRenderer component={cell} />
                  ) : (
                    cell
                  )}
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  ),

  // 新增：图表组件 (chart)
  chart: ({ chartType = 'bar', data, options = {}, style = {} }) => {
    const chartProps = {
      data: data || { labels: [], datasets: [] },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: options.legendPosition || 'top' },
          title: { display: !!options.title, text: options.title || '' },
        },
        ...options,
      },
    }

    const ChartComponent = {
      bar: Bar,
      line: Line,
      pie: Pie,
      doughnut: Doughnut,
      radar: Radar,
    }[chartType.toLowerCase()]

    if (!ChartComponent) {
      return <div className="text-red-500">不支持的图表类型: {chartType}</div>
    }

    return (
      <div style={{ ...style, height: '400px', width: '100%' }}>
        <ChartComponent {...chartProps} />
      </div>
    )
  },
  // 扩展更多组件基于 A2UI 示例
}

interface A2UIRendererProps {
  component: any
  onAction?: (handler: string, data?: any) => void
}

const A2UIRenderer: React.FC<A2UIRendererProps> = ({ component, onAction }) => {
  const { type, id, ...props } = component
  const Component = componentRegistry[type.toLowerCase()]

  if (!Component) return <div className="text-red-500">未知组件: {type}</div>
  return <Component {...props} onAction={onAction} />
}

export default A2UIRenderer
